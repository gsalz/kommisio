function addItem() {
    const nev = document.getElementById("nev").value;
    let visszaigazolasok = document.getElementById("visszaigazolas").value.trim();

    const now = new Date();
    const formattedDate = now.toLocaleString('hu-HU', { 
        year: 'numeric', month: '2-digit', day: '2-digit', 
        hour: '2-digit', minute: '2-digit' 
    });

    if (!nev || !visszaigazolasok) {
        alert("Kérlek, töltsd ki mindkét mezőt!");
        return;
    }

    let rows = JSON.parse(localStorage.getItem("komissioData") || "[]");
    visszaigazolasok = visszaigazolasok.split(",").map(num => num.trim());

    const existingNumbers = rows.map(row => row.visszaigazolas);
    const duplicateNumbers = visszaigazolasok.filter(num => existingNumbers.includes(num));

    if (duplicateNumbers.length > 0) {
        alert(`Hiba: Ezek a visszaigazoló számok már léteznek: ${duplicateNumbers.join(", ")}`);
        return;
    }

    visszaigazolasok.forEach(visszaigazolas => {
        rows.push({ datum: formattedDate, nev, visszaigazolas, bevitt: false, bevittDatum: "" });
    });

    localStorage.setItem("komissioData", JSON.stringify(rows));

    renderTable();
    document.getElementById("visszaigazolas").value = "";
    document.getElementById("nev").value = "";
}

function renderTable() {
    const tableBody = document.getElementById("table-body");
    tableBody.innerHTML = "";
    const rows = JSON.parse(localStorage.getItem("komissioData") || "[]");

    rows.forEach((item, index) => {
        const row = tableBody.insertRow();
        row.insertCell(0).textContent = item.datum;
        row.insertCell(1).textContent = item.nev;
        row.insertCell(2).textContent = item.visszaigazolas;

        // Bevitt checkbox
        const checkCell = row.insertCell(3);
        const checkBox = document.createElement("input");
        checkBox.type = "checkbox";
        checkBox.checked = item.bevitt;
        checkBox.onclick = function () {
            const now = new Date();
            rows[index].bevitt = checkBox.checked;
            rows[index].bevittDatum = checkBox.checked ? now.toLocaleString('hu-HU', { 
                year: 'numeric', month: '2-digit', day: '2-digit', 
                hour: '2-digit', minute: '2-digit' 
            }) : "";
            localStorage.setItem("komissioData", JSON.stringify(rows));
            renderTable();
        };
        checkCell.appendChild(checkBox);

        // Bevitt dátum
        const bevittDatumCell = row.insertCell(4);
        bevittDatumCell.textContent = item.bevittDatum || "-";

        // Törlés gomb
        const deleteCell = row.insertCell(5);
        const deleteButton = document.createElement("button");
        deleteButton.textContent = "❌";
        deleteButton.onclick = function () {
            if (confirm("Biztosan törölni szeretnéd ezt a sort?")) {
                rows.splice(index, 1);
                localStorage.setItem("komissioData", JSON.stringify(rows));
                renderTable();
            }
        };
        deleteCell.appendChild(deleteButton);
    });
}
